var showFollowButton=function(){return !sessionUserIsPageUser()||$("body").hasClass("followers")};var fadeUserOnUnfollow=function(){return sessionUserIsPageUser()&&$("body").hasClass("following")};$.fn.isCtrlBar=function(){var A=$("#follow_grid");return this.each(function(){$(this).find("a").click(function(B){A.attr("class","follow-"+$(this).attr("class"));$.cookie("follow_view",$(this).attr("class"));B.preventDefault()}).tipsy({gravity:"s"})})};$.fn.isUser=function(){return this.each(function(){var H=$(this);var B=H.find(".user-settings a").isUserSetting().tipsy({gravity:"s"});var A=H.find(".follow-action button").tipsy({gravity:"s"});var E=H.find(".accept-action button").tipsy({gravity:"s"});var D=H.find(".deny-action button").tipsy({gravity:"s"});var C=H.find(".user-actions .action-menu button").isUserActionMenu();try{H.find(".user-actions .list-menu button").isUserListMenu().tipsy({gravity:"s"})}catch(G){}var F=H.find(".is-pending .cancel a, .is-blocked .unblock a, .follow-action button, .accept-action button, .deny-action button").isUserActionLink()})};var successfulUndo=function(D){var B=D.find(".undo");var A=B.data("previousClass");successfulUnblock(D);if($("body#friend_requests").length){var C=D.find("strong a").text();(new InfoNotification()).setMessage(_("OK, you've unblocked %{username}",{username:C})).show();D.fadeOut()}else{if(sessionUserIsPageUser()){D.html(B.data("originalHtml"));D.isUser()}D.attr("class",A);$(".protected-profile-controls").hide()}};var successfulUnblock=function(B){var A="";if(sessionUserIsPageUser()){updateFollowersCount(-1);A=B.find(".screen-name")}else{B.removeClass("blocking").find(".is-blocked").remove();$("ul.sidebar-actions").removeClass("blocked").addClass("unblocked");A=B.find("div.screen-name")}};var successfulReportAsSpamOrBlock=function(B,A,G){if(B!="follow"){if(sessionUserIsPageUser()){updateFollowersCount(-1);var H=jQuery.trim(A.find("span.screenname a").text());var D=(B=="report-for-spam")?$("#is_blocked_as_spammer_with_undo_and_username"):$("#is_blocked_with_undo_and_username");var I=A.html();A.html('<td colspan="3">'+replaceParams(D.html(),{user:H})+"</td>");A.find(".is-blocked").show();A.find(".undo").data("undoCommands",G).data("originalHtml",I);A.find(".is-blocked .unblock a, .is-blocked .undo a").isUserActionLink()}else{var F=$(B!="report-for-spam"?"#is_blocked_with_undo":"#is_blocked_as_spammer");var E=A.attr("class");A.addClass("blocking").removeClass("following").find(".is-relationship").append(F.html()).end().find(".is-blocked .unblock a, .is-blocked .undo a").isUserActionLink();var C=A.find(".undo");C.data("undoCommands",G);C.data("previousClass",E);$("ul.sidebar-actions").removeClass("unblocked").addClass("blocked");$(".protected-profile-controls").show()}}else{new InfoNotification().setMessage(_("This user has blocked you from following them.")).show()}};var sendSidebarAction=function(A){if(!A.data){A.data={}}A.data.authenticity_token=twttr.form_authenticity_token;A.data.twttr=true;$.ajax({type:"POST",dataType:"json",url:A.url,data:A.data,complete:function(){$(this).blur()},success:A.success,error:function(){twttr.error()}})};function User(A){}$(function(){var B=$("ul.sidebar-actions");if(B.length>0){var C=$("div.profile-user div.user");var A=B.attr("id").replace("sidebar_actions_for_user_","");$("li.unblock-sidebar-action a").bind("click",function(){var D=C.find(".undo").data("undoCommands");if(D){sendSidebarAction({url:"/blocks/undo",data:{user_id:A,undo_commands:D},success:function(){successfulUndo(C)}})}else{sendSidebarAction({url:"/blocks/destroy/"+A,success:function(){successfulUnblock(C)}})}return false});$("li.report-for-spam-sidebar-action a").bind("click",function(){sendSidebarAction({url:"/user_spam_reports/"+A,dataType:"json",success:function(D){switch(D.result){case"reported_as_spam":successfulReportAsSpamOrBlock("report-for-spam",C,D.undo_commands);break;case"over_limit":(new ErrorNotification()).setMessage(D.notice).show();break}},userId:A});return false});$("li.block-sidebar-action a").bind("click",function(){sendSidebarAction({url:"/blocks/create/"+A,success:function(D){successfulReportAsSpamOrBlock("block",C,D.undo_commands)},userId:A});return false})}});$.fn.isAcceptDenyAllLink=function(){return this.each(function(){$(this).click(function(){var A=$(this);A.parents("form").attr("action",A.attr("href")).submit();return false})})};$.fn.isUserActionLink=function(){return this.each(function(){var A=$("#is_following");var B=$("#is_pending");$(this).click(function(I){var J=$(this);var E=J.parents(".user");var H=E.attr("id").replace("user_","");var F=J.parent("li, span").attr("class").replace("-action","");var D=E.find(".screenname a, .screen-name").html();var K=J.parents(".user-actions");var L="";if($("body#friend_requests").length&&K.length){L=(K.attr("id")||"").replace("req_","")}switch(F){case"mention":case"direct-message":document.location=J.attr("href")+D;break;case"block":case"remove":case"undo":case"follow":case"unfollow":case"cancel":case"report-for-spam":case"unblock":case"accept":case"deny":if(F=="remove"&&!confirm(_("Are you sure you want to remove this person from your followers?"))){return false}var C=J.attr("href");var G={authenticity_token:twttr.form_authenticity_token,twttr:true};if(F=="undo"){G.undo_commands=E.find(".undo").data("undoCommands")}if(F=="cancel"||F=="undo"||F=="accept"||F=="deny"){G.user_id=H}else{C+=H}$.ajax({type:"POST",dataType:"json",url:C,data:G,complete:function(){J.blur()},success:function(M){switch(M.result){case"unfollowed":if(sessionUserIsPageUser()){updateFollowingCount(-1)}else{updateFollowersCount(-1)}if(fadeUserOnUnfollow()){E.fadeOut("medium",function(){E.remove()})}else{E.removeClass("following").find(".is-following").remove().end().find(".follow-action").show().end().find(".user-settings .on").attr("class","off")}break;case"added":if(sessionUserIsPageUser()){updateFollowingCount(1)}else{if($("body#profile").length){updateFollowersCount(1)}}E.addClass("following").removeClass("blocking").find(".is-following, .is-pending, .is-blocked").remove().end().find(".is-relationship").append(A.html()).end().find(".user-settings .shares-setting a").removeClass("off").addClass("on");break;case"follow_request":E.addClass("pending").find(".is-relationship").append(B.html()).end().find(".is-pending .cancel a").isUserActionLink();break;case"canceled":E.removeClass("pending").find(".is-pending").remove();break;case"undone":successfulUndo(E);break;case"removed":if(sessionUserIsPageUser()){updateFollowersCount(-1);E.fadeOut("medium",function(){E.remove()})}break;case"reported_as_spam":case"blocked":successfulReportAsSpamOrBlock(F,E,M.undo_commands);break;case"over_limit":(new ErrorNotification()).setMessage(M.notice).show();break;case"accepted":$(".tipsy").hide();E.replaceWith(M.accepted_user);E=$("#user_"+H).isUser();break;case"denied":E.fadeOut();break;default:if(F=="unblock"&&!M.following){successfulUnblock(E)}}},error:function(){twttr.error()}});break}I.preventDefault()})})};$.fn.isUserActionMenu=function(){$actionMenu=$("#action_menu");return this.one("click",function(){var B=$(this);var A=B.parents(".user").find(".screenname a, .screen-name").html();$("body").click();B.addClass("clicked").after($actionMenu.html());B.siblings("ul").find("a").find("span").html(A).end().isUserActionLink();$("html").one("click",function(){B.removeClass("clicked").blur().siblings("ul").remove().end().isUserActionMenu();return false});return false})};$.fn.isUserSetting=function(){return this.click(function(F){var A=$(this);var E=A.parent(".setting");var B=A.parents(".user").attr("id").replace("user_","");var C=E.attr("class").match(/(\w+)-setting/)[1];var D=A.hasClass("off")?"on":"off";if(C.length>0){$.ajax({type:"POST",dataType:"json",url:"/friendships/set_"+C,data:{user_ids:[B],value:D,authenticity_token:twttr.form_authenticity_token,twttr:true},beforeSend:function(){A.toggleClass("off").toggleClass("on").attr("title",window.titleText[C][D])},complete:function(){A.trigger("mouseenter");setTimeout(function(){A.trigger("mouseleave")},2000)},error:function(){A.toggleClass("off").toggleClass("on")}})}F.preventDefault()})};$.fn.isProfileSidebarAcceptDenyLink=function(){return this.click(function(D){var A=$(this);var E=$(".profile-user .user");var B=E.attr("id").replace("user_","");var C=A.hasClass("accept")?"accept":"deny";$.ajax({type:"POST",dataType:"json",url:"/friend_requests/"+C,data:{authenticity_token:twttr.form_authenticity_token,user_id:B},success:function(F){A.parents(".notify").hide();new ShortNotification().setMessage(F.result=="accepted"?_("Okay! <strong>%{screen_name}</strong> will now receive your tweets.",{screen_name:page.pageUserScreenName}):_("<strong>%{screen_name}</strong> will not receive your tweets.",{screen_name:page.pageUserScreenName})).show()}})})};